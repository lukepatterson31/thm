# Breaching Active Directory

Set up:

Change DNS in Advanced Network Configuration to THMDC IP

### OSINT and Phishing

OSINT

- Users who ask questions on public forums such as Stack Overflow but disclose sensitive 
information such as their credentials in the question.

- Developers that upload scripts to services such as Github with credentials hardcoded.

- Credentials being disclosed in past breaches since employees used their work accounts to 
sign up for other external websites. Websites such as HaveIBeenPwned and DeHashed provide 
excellent platforms to determine if someone's information, such as work email, was ever 
involved in a publicly known data breach.

Red Team OSINT room [here](https://tryhackme.com/jr/redteamrecon).

Phishing

Phishing is another excellent method to breach AD. Phishing usually entices users to either 
provide their credentials on a malicious web page or ask them to run a specific application 
that would install a Remote Access Trojan (RAT) in the background. 

This is a prevalent method since the RAT would execute in the user's context, immediately 
allowing you to impersonate that user's AD account.

Phishing room [here](https://tryhackme.com/module/phishing).


### NTLM Authenticated Services

**NTLM and NetNTLM**

New Technology LAN Manager (NTLM) is the suite of security protocols used to authenticate 
users' identities in AD. NTLM can be used for authentication by using a _challenge-response 
based scheme called NetNTLM_.

This authentication mechanism is heavily used by the services on a network. However, 
services that use NetNTLM can also be exposed to the internet.

- Internally-hosted Exchange (Mail) servers that expose an Outlook Web App (OWA) login 
portal.

- Remote Desktop Protocol (RDP) service of a server being exposed to the internet.

- Exposed VPN endpoints that were integrated with AD.

- Web applications that are internet-facing and make use of NetNTLM.

NetNTLM, also often referred to as Windows Authentication or just NTLM Authentication, 
allows the application to play the role of a middle man between the client and AD. 

All authentication material is forwarded to a Domain Controller in the form of a challenge, 
and if completed successfully, the application will authenticate the user.

This means that the application is authenticating on behalf of the user and not 
authenticating the user directly on the application itself. 

This prevents the application from storing AD credentials, which should only be stored on a 
Domain Controller.

![Authentication process](../pictures/netntlm.png)


**Brute-force Login Attacks**


